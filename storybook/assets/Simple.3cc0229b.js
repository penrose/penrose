var l=Object.defineProperty;var c=(i,e,s)=>e in i?l(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var t=(i,e,s)=>(c(i,typeof e!="symbol"?e+"":e,s),s);import{b as d,p as m,s as h,d as u,e as f,r as v,R as y,f as S,g}from"./PenrosePrograms.daf6ec92.js";import{R as a}from"./index.5c77362b.js";import{j as r,a as o}from"./jsx-runtime.1c361ae2.js";async function p(i){const e=await fetch(i);if(!e.ok){console.error(`could not fetch ${i}`);return}return await e.text()}class w extends a.Component{constructor(e){super(e);t(this,"canvasRef",a.createRef());t(this,"penroseState");t(this,"timerID");t(this,"compile",async()=>{this.penroseState=void 0;const e=d(this.props);e.isOk()?this.penroseState=await m(e.value):this.setState({error:e.error})});t(this,"converge",async()=>{if(this.penroseState){const e=h(this.penroseState);e.isOk()?this.penroseState=e.value:this.setState({error:e.error})}});t(this,"tick",()=>{var e;this.props.animate&&this.penroseState&&!u(this.penroseState)&&(this.penroseState=f(this.penroseState,(e=this.props.stepSize)!=null?e:1),this.props.onFrame&&this.props.onFrame(this.penroseState),this.renderCanvas())});t(this,"componentDidMount",async()=>{await this.compile(),this.props.animate||await this.converge(),this.renderCanvas(),this.timerID=window.setInterval(()=>this.tick(),1e3/60)});t(this,"componentDidUpdate",async e=>{(this.props.domain!==e.domain||this.props.substance!==e.substance||this.props.style!==e.style)&&(await this.compile(),this.props.animate||await this.converge(),this.renderCanvas()),this.penroseState&&!this.state.error&&(this.props.variation!==e.variation||this.props.animate!==e.animate?(this.penroseState.variation=this.props.variation,this.penroseState=v(this.penroseState),this.props.animate||await this.converge(),this.renderCanvas()):this.props.interactive!==e.interactive&&this.renderCanvas())});t(this,"componentWillUnmount",()=>{clearInterval(this.timerID)});t(this,"renderCanvas",async()=>{if(this.canvasRef.current===null)return r("div",{children:"rendering..."});{const e=this.canvasRef.current;if(this.penroseState){const s=await(this.props.interactive===!1?y(this.penroseState,p):S(this.penroseState,async n=>{this.penroseState=n,this.props.animate||await this.converge(),this.renderCanvas()},p));e.firstChild!==null?e.replaceChild(s,e.firstChild):e.appendChild(s)}else console.log("state is undefined")}});t(this,"render",()=>{const{error:e}=this.state;return o("div",{style:{width:"100%",height:"100%"},children:[!e&&r("div",{style:{width:"100%",height:"100%"},ref:this.canvasRef}),e&&o("div",{style:{padding:"1em",height:"100%"},children:[r("div",{style:{fontWeight:700},children:"1 error:"}),r("div",{style:{fontFamily:"monospace"},children:g(e).toString().split(`
`).map((s,n)=>r("p",{style:{margin:0},children:s},`err-ln-${n}`))})]})]})});this.state={error:void 0}}}w.__docgenInfo={description:"",methods:[{name:"compile",docblock:null,modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},{name:"converge",docblock:null,modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},{name:"tick",docblock:null,modifiers:[],params:[],returns:null},{name:"componentDidMount",docblock:null,modifiers:["async"],params:[],returns:null},{name:"componentDidUpdate",docblock:null,modifiers:["async"],params:[{name:"prevProps",type:{name:"SimpleProps",alias:"SimpleProps"}}],returns:null},{name:"componentWillUnmount",docblock:null,modifiers:[],params:[],returns:null},{name:"renderCanvas",docblock:null,modifiers:["async"],params:[],returns:null},{name:"render",docblock:null,modifiers:[],params:[],returns:null}],displayName:"Simple",props:{domain:{required:!0,tsType:{name:"string"},description:""},substance:{required:!0,tsType:{name:"string"},description:""},style:{required:!0,tsType:{name:"string"},description:""},variation:{required:!0,tsType:{name:"string"},description:""},stepSize:{required:!1,tsType:{name:"number"},description:""},interactive:{required:!1,tsType:{name:"boolean"},description:""},animate:{required:!1,tsType:{name:"boolean"},description:""},onFrame:{required:!1,tsType:{name:"signature",type:"function",raw:"(frame: PenroseState) => void",signature:{arguments:[{name:"frame",type:{name:"PenroseState"}}],return:{name:"void"}}},description:""}}};export{w as S};
//# sourceMappingURL=Simple.3cc0229b.js.map
