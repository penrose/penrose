import{b as Et,R as $t,T as Ct,A as Nt,s as Mt,m as Rt,g as v,e as N,a as dt,o as V,u as j,i as ht,t as P,d as Z,f as x,h as _,r as et,_ as Tt,j as J,k as zt,n as nt,p as It,q as Vt,v as rt,w as Bt,x as Dt,y as Ft,B as Ot,C as Lt,D as Xt,c as qt,E as Yt,F as jt,G as _t,H as Wt,I as Ht,__tla as __tla_0}from"./svg-dfcfad54.js";import{R as ot,j as D,a as st,F as Gt}from"./jsx-runtime-f8704ad2.js";let G;let __tla=Promise.all([(()=>{try{return __tla_0}catch{}})()]).then(async()=>{var kt=Object.defineProperty;var a=(t,e)=>kt(t,"name",{value:e,configurable:!0});const Pt=a(()=>{const t=Et();$t(t);const e=new Ct({packages:Nt,macros:{textsc:["\\style{font-variant-caps: small-caps}{\\text{#1}}",1]},inlineMath:[["$","$"],["\\(","\\)"]],processEscapes:!0,formatError:(s,i)=>{throw Error(i.message)}}),r=new Mt.SVG({fontCache:"none"}),n=Rt.mathjax.document("",{InputJax:e,OutputJax:r});return a(s=>{try{const i=n.convert(s,{});return V(i.firstChild)}catch(i){return N(i.message)}},"convert")},"mathjaxInit"),Zt=a(t=>{const e=/^(\d+(?:\.\d+)?)\s*(px|in|cm|mm)$/,r=t.match(e);if(!r)return;const n=parseFloat(r[1]),o=r[2];return{number:n,unit:o}},"parseFontSize"),Ut=a((t,e)=>({px:1,in:96,cm:37.79527559055118,mm:3.7795275590551185})[e]*t,"toPxFontSize"),Kt=a(async(t,e)=>new Promise(r=>{const n=v(t.string,""),o=v(t.fontSize,"");(o===""||n==="")&&r(N(`Label 'string' and 'fontSize' must be non-empty and non-optimized for ${t.name.contents}`));const s=e(n);if(s.isErr()){r(N(`MathJax could not render $${n}$: ${s.error}`));return}const i=s.value,c=i.getAttribute("viewBox");if(c===null){r(N(`No ViewBox found for MathJax output $${n}$`));return}const l=c.split(" "),h=parseFloat(l[2])/1e3,u=parseFloat(l[3])/1e3,d=-parseFloat(i.style.verticalAlign),g=parseFloat(i.getAttribute("height")),m=Zt(o);if(m){const{number:f,unit:w}=m,y=a(C=>C*Ut(f,w),"em_to_px"),A=y(h),b=y(u),p=d/g*b,M=b-p;r(V({body:i,width:A,height:b,descent:p,ascent:M}))}else{r(N('Invalid font size format. Only "px", "in", "cm", and "mm" units are supported.'));return}}),"tex2svg"),z=a(t=>({tag:"FloatV",contents:t}),"floatV"),it=a((t,e,r,n)=>({tag:"TextData",width:z(t),height:z(e),descent:z(r),ascent:z(n)}),"textData"),Jt=a((t,e,r,n,o)=>({tag:"EquationData",width:z(t),height:z(e),ascent:z(r),descent:z(n),rendered:o}),"equationData"),gt=a(t=>{const e=v(t.fontFamily),r=v(t.fontSize),n=v(t.fontStretch),o=v(t.fontStyle),s=v(t.fontVariant),i=v(t.fontWeight),c=v(t.lineHeight),l=`${n} ${o} ${s} ${i} ${r} ${e}`;return c!==""?l.concat(`/${c}`):l},"toFontRule"),mt=a(async(t,e)=>{const r=new Map;for(const n of t)if(n.shapeType==="Equation"){const o=v(n.name),s=await Kt(n,e);if(s.isErr())return N({errorType:"SubstanceError",tag:"Fatal",message:s.error});const{body:i,width:c,height:l,ascent:h,descent:u}=s.value,d=Jt(c===1/0?0:c,l===1/0?0:l,h,u,i);r.set(o,d)}else if(n.shapeType==="Text"){const o=v(n.name);let s;const i=Qt(v(n.string),gt(n));i.width&&i.height?s=it(i.width,i.height,i.actualDescent,i.actualAscent):s=it(0,0,0,0),r.set(o,s)}else if(n.shapeType==="Group"){const o=dt(n.shapes),s=await mt(o,e);if(s.isErr())return s;for(const[i,c]of s.value.entries())r.set(i,c)}return V(r)},"collectLabels");function Qt(t,e){const r=document.createElement("canvas"),n=r.getContext("2d");n.textBaseline="alphabetic",n.font=e;const o=n.measureText(t);return r.remove(),{width:Math.abs(o.actualBoundingBoxLeft)+Math.abs(o.actualBoundingBoxRight),height:Math.abs(o.actualBoundingBoxAscent)+Math.abs(o.actualBoundingBoxDescent),actualDescent:Math.abs(o.actualBoundingBoxDescent),actualAscent:Math.abs(o.actualBoundingBoxAscent)}}a(Qt,"measureText");const T=a((t,e,r,n)=>{if(typeof r.contents!="number"&&r.contents.tag==="Var"){const{index:o,meta:s}=j(e.get(r.contents),()=>"missing input");s.init.tag==="Pending"&&(t[o]=n.contents)}},"setPendingProperty"),pt=a((t,e,r,n)=>{for(const o of t)if(o.shapeType==="Group"){const s=dt(o.shapes);pt(s,e,r,n)}else if(o.shapeType==="Equation"){const s=j(r.get(o.name.contents),()=>`missing label: ${o.name.contents}. Label cache: ${[...r.keys()].join(" ")}`);if(s.tag!=="EquationData")throw Error(`for ${o.shapeType} ${o.name.contents} got unexpected ${s.tag}`);T(e,n,o.width,s.width),T(e,n,o.height,s.height),T(e,n,o.ascent,s.ascent),T(e,n,o.descent,s.descent)}else if(o.shapeType==="Text"){const s=j(r.get(o.name.contents),()=>`missing label: ${o.name.contents}`);if(s.tag!=="TextData")throw Error(`for ${o.shapeType} ${o.name.contents} got unexpected ${s.tag}`);T(e,n,o.width,s.width),T(e,n,o.height,s.height),T(e,n,o.ascent,s.ascent),T(e,n,o.descent,s.descent)}},"insertPendingHelper"),ft=a(t=>{const e=[...t.varyingValues],r=new Map(t.inputs.map(({handle:n,meta:o},s)=>[n,{index:s,meta:o}]));return pt(t.shapes,e,t.labelCache,r),{...t,varyingValues:e}},"insertLabelMeasurements"),at={accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",overlinePosition:"overline-position",overlineThickness:"overline-thickness",panose1:"panose-1",paintOrder:"paint-order",pointerEvents:"pointer-events",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDasharray:"stroke-dasharray",strokeDashoffset:"stroke-dashoffset",strokeLinecap:"stroke-linecap",strokeLinejoin:"stroke-linejoin",strokeMiterlimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode"},E=a((t,e,r)=>{const n=["name","ensureOnCanvas"],o=new Set(r.concat(n));for(const[s,i]of t.passthrough)if(!(i.tag==="StrV"&&i.contents===""||o.has(s)))if(ht(s,at)){const c=at[s];e.hasAttribute(c)||e.setAttribute(c,i.contents.toString())}else if(s==="style"&&i.contents!==""){const c=e.getAttribute(s);c===null?e.setAttribute(s,i.contents.toString()):e.setAttribute(s,`${c}${i.contents.toString()}`)}else e.hasAttribute(s)||e.setAttribute(s,i.contents.toString())},"attrAutoFillSvg"),R=a((t,e)=>{const r=t.fillColor,n=P(r.contents);return e.setAttribute("fill",Z(r.contents)),r.contents.tag!=="NONE"&&e.setAttribute("fill-opacity",n.toString()),["fillColor"]},"attrFill"),wt=a((t,e,r)=>{const n=t.center,[o,s]=x([n.contents[0],n.contents[1]],e);return r.setAttribute("cx",o.toString()),r.setAttribute("cy",s.toString()),["center"]},"attrCenter"),St=a((t,e)=>{let r=t.scale.contents;r=r||1;let n=e.getAttribute("transform");return n=n===null?`scale(${r})`:n+`scale{${r}}`,e.setAttribute("transform",n),["scale"]},"attrScale"),At=a((t,e,r)=>{const n=t.center,[o,s]=x([n.contents[0],n.contents[1]],e),i=t.width,c=t.height;let l=r.getAttribute("transform");return l=l===null?`translate(${o-i.contents/2}, ${s-c.contents/2})`:l+`translate(${o-i.contents/2}, ${s-c.contents/2})`,r.setAttribute("transform",l),["center","width","height"]},"attrTransformCoords"),te=a((t,e,r)=>{const n=t.center,[o,s]=x([n.contents[0],n.contents[1]],e),i=t.width,c=t.height;return r.setAttribute("x",(o-i.contents/2).toString()),r.setAttribute("y",(s-c.contents/2).toString()),["center","width","height"]},"attrXY"),U=a((t,e,r)=>{t.width,t.height;const n=t.center,o=t.rotation.contents,[s,i]=x([n.contents[0],n.contents[1]],e);let c=r.getAttribute("transform");return c=c===null?`rotate(${o}, ${s}, ${i})`:c+`rotate(${o}, ${s}, ${i})`,r.setAttribute("transform",c),["rotation","center","width","height"]},"attrRotation"),F=a((t,e)=>{const r=t.width,n=t.height;return e.setAttribute("width",Math.max(r.contents,0).toString()),e.setAttribute("height",Math.max(n.contents,0).toString()),["width","height"]},"attrWH"),ee=a((t,e)=>{const r=t.cornerRadius;return e.setAttribute("rx",r.contents.toString()),["cornerRadius"]},"attrCornerRadius"),ne=a((t,e)=>{const r=t.string,n=document.createTextNode(r.contents.toString());return e.appendChild(n),["string"]},"attrString"),re="7,5",I=a((t,e)=>{const r=[],n=t.strokeColor,o=P(n.contents),s=t.strokeWidth.contents;return e.setAttribute("stroke",Z(n.contents)),r.push("strokeColor","strokeWidth"),n.contents.tag!=="NONE"&&(e.setAttribute("stroke-opacity",o.toString()),e.setAttribute("stroke-width",s.toString()),"strokeDasharray"in t&&t.strokeDasharray.contents!==""?(e.setAttribute("stroke-dasharray",t.strokeDasharray.contents),r.push("strokeDasharray")):"strokeStyle"in t&&t.strokeStyle.contents==="dashed"&&(e.setAttribute("stroke-dasharray",re.toString()),r.push("strokeDasharray","strokeStyle")),"strokeLinecap"in t&&t.strokeLinecap.contents!==""&&(e.setAttribute("stroke-linecap",t.strokeLinecap.contents),r.push("strokeLinecap"))),r},"attrStroke"),$=a((t,e)=>{const r=t.name,n=document.createElementNS("http://www.w3.org/2000/svg","title");return n.textContent=r.contents,e.appendChild(n),["name"]},"attrTitle"),oe=a((t,e)=>{const r=gt(t),n=e.getAttribute("style");return e.setAttribute("style",n?`${n}; font: ${r};`:`font: ${r};`),["fontFamily","fontSize","fontStretch","fontStyle","fontVariant","fontWeight","lineHeigh"]},"attrFont"),bt=a((t,e,r)=>{const o=t.points.contents.map(s=>x([s[0],s[1]],e));return r.setAttribute("points",o.toString()),["points"]},"attrPolyPoints"),se=a((t,{canvasSize:e})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","circle"),n=[];return n.push(...R(t,r)),n.push(...wt(t,e,r)),n.push(...I(t,r)),n.push(...$(t,r)),r.setAttribute("r",Math.max(0,t.r.contents).toString()),n.push("r"),E(t,r,n),r},"RenderCircle"),ie=a((t,{canvasSize:e})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),n=[];return n.push(...R(t,r)),n.push(...wt(t,e,r)),n.push(...I(t,r)),n.push(...$(t,r)),r.setAttribute("rx",Math.max(t.rx.contents,0).toString()),n.push("rx"),r.setAttribute("ry",Math.max(t.ry.contents,0).toString()),n.push("ry"),E(t,r,n),r},"RenderEllipse"),K=a((t,[e,r],n)=>{const o=document.createElementNS("http://www.w3.org/2000/svg","text");return o.textContent=t,R(n,o),F(n,o),o.setAttribute("x",`${e}`),o.setAttribute("y",`${r}`),o.setAttribute("alignment-baseline","alphabetic"),o.setAttribute("dominant-baseline","alphabetic"),o.setAttribute("text-anchor","middle"),o},"placeholderString"),ae=a((t,e)=>{const{canvasSize:r,labels:n,texLabels:o}=e,{center:s}=t,[i,c]=x([s.contents[0],s.contents[1]],r);if(o){const d=c+t.height.contents/2-t.descent.contents;let g=K(`$${v(t.string)}$`,[i,d],t);for(const[m,f]of t.passthrough)m==="texContourColor"&&f.contents!==""&&(g=K(`\\contour{${f.contents}}{$${v(t.string)}$}`,[i,d],t));return g}const l=document.createElementNS("http://www.w3.org/2000/svg","g"),h=[];h.push(...U(t,r,l)),h.push(...At(t,r,l)),h.push(...$(t,l));const u=n.get(v(t.name));if(u&&u.tag==="EquationData"){const d=u.rendered.cloneNode(!0),g=d.getElementsByTagName("g")[0];h.push(...R(t,g)),h.push(...F(t,d)),g.setAttribute("stroke","none"),g.setAttribute("stroke-width","0");const m=t.fontSize;return d.setAttribute("style",`font-size: ${m.contents}`),l.appendChild(d),E(t,l,h),l}else return K(v(t.string),[i,c],t)},"RenderEquation"),ce=`<?xml version="1.0" encoding="UTF-8"?>
<svg id="uuid-14337243-9689-41d7-b7ce-2960e3a1016a" data-name="uuid-95bf6e06-fb2b-43f6-8f44-0afdfcaaf242" xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200">
  <polygon points="132.5 2.1 175.7 45.3 175.7 197.9 24.3 197.9 24.3 2.1 132.5 2.1" style="fill: #e0e0e0; stroke: #7f7f7f; stroke-width: 4.039px;"/>
  <g>
    <path d="m157.4,77.75l-46.2-33.4-42.1,30.4m42.2-46.9l-46.4,33.5,15.7,49.1m38.2,0h-51.4l-18-54.1m7.8,66.9h57.1l17.1-48.4m-7.3,62l17.9-54.1-42.2-30.9m38,85H61.6l-23.4-72.3,61.5-44.9,62.1,44.9-24,72.3Z" style="fill: none; stroke: #ffb6b6; stroke-width: 4.034px;"/>
    <path d="m77,66.3c0-3.4.5-6.5,1.4-9.4s2.3-5.3,4.2-7.3c1.8-2,4.2-3.6,7-4.8s6.1-1.7,9.7-1.7c8,0,13.9,2,17.9,5.9,3.9,3.9,5.9,9.2,5.9,15.8,0,3.2-.5,6.1-1.5,8.8s-2.9,5.6-5.6,8.8l-4.5,5.1c-2,2.2-3.4,4.2-4.2,6-.9,1.8-1.3,4.1-1.3,7h0c0,.9-.8,1.7-1.7,1.7h-10.7c-.9,0-1.7-.8-1.7-1.7v-2.7c0-3.8.5-6.9,1.6-9.5s2.9-5.3,5.4-8.2l4.3-4.8c1.6-1.7,2.7-3.6,3.3-5.6.6-2,1-4.1,1-6.4,0-2.9-.6-5.2-1.9-6.9-1.3-1.8-3.2-2.6-5.7-2.6-2.9,0-4.9,1.1-6.1,3.4-1.2,2.3-1.9,5.3-1.9,9v1.1c0,.9-.8,1.7-1.7,1.7h-11.6c-.9,0-1.7-.8-1.7-1.7v-1h.1Zm28,58.1h-12.2c-.9,0-1.7-.8-1.7-1.7v-11.5c0-.9.8-1.7,1.7-1.7h12.2c.9,0,1.7.8,1.7,1.7v11.5c0,1-.8,1.7-1.7,1.7Z" style="fill: red;"/>
  </g>
  <g style="isolation: isolate;">
    <g style="isolation: isolate;">
      <path d="m58.52,179.451h-8.066v-9.533h8.066v9.533Z"/>
      <path d="m70.802,169.795c0,1.427.376,2.577,1.131,3.453.753.876,1.843,1.313,3.269,1.313,1.303,0,2.342-.325,3.117-.978.773-.651,1.161-1.629,1.161-2.934,0-1.059-.306-1.863-.917-2.414-.611-.55-1.324-.987-2.139-1.313l-5.928-2.139c-2.322-.814-4.074-1.965-5.255-3.453-1.182-1.486-1.772-3.392-1.772-5.713,0-1.345.224-2.617.672-3.819.448-1.201,1.161-2.251,2.139-3.147.978-.896,2.23-1.609,3.758-2.139s3.371-.795,5.53-.795c3.829,0,6.661.815,8.494,2.444,1.833,1.63,2.75,3.933,2.75,6.905v1.345h-7.578c0-1.711-.275-2.964-.825-3.758-.55-.795-1.519-1.192-2.903-1.192-1.06,0-1.986.296-2.781.887-.794.591-1.191,1.477-1.191,2.658,0,.815.254,1.549.764,2.199.509.652,1.477,1.202,2.903,1.65l5.072,1.711c2.647.896,4.522,2.068,5.622,3.514,1.1,1.447,1.65,3.413,1.65,5.897,0,1.752-.306,3.27-.917,4.553-.611,1.283-1.457,2.353-2.536,3.208-1.08.855-2.363,1.467-3.85,1.833-1.488.367-3.127.55-4.919.55-2.363,0-4.329-.224-5.897-.672-1.569-.448-2.811-1.12-3.728-2.017-.917-.896-1.558-1.986-1.925-3.27s-.55-2.719-.55-4.308v-1.161h7.578v1.1Z"/>
      <path d="m115.778,146.574l-8.25,32.877h-9.778l-8.494-32.877h8.8l4.705,23.527h.123l4.461-23.527h8.434Z"/>
      <path d="m143.52,177.8c0,4.237-1.049,7.415-3.146,9.533-2.099,2.118-5.612,3.178-10.541,3.178-3.586,0-6.347-.764-8.28-2.291-1.936-1.528-2.903-3.697-2.903-6.509h8.066c0,1.06.428,1.895,1.283,2.506.407.284.846.509,1.314.672.468.162.967.245,1.497.245,1.711,0,2.912-.551,3.605-1.65.692-1.1,1.038-2.466,1.038-4.095v-4.338h-.122c-.855,1.222-1.904,2.199-3.146,2.933-1.243.733-2.536,1.101-3.881,1.101-3.341,0-5.856-1.273-7.547-3.819-1.691-2.546-2.536-6.814-2.536-12.803,0-1.914.112-3.87.336-5.866s.692-3.799,1.406-5.408c.712-1.609,1.751-2.923,3.116-3.941,1.364-1.019,3.188-1.528,5.469-1.528,1.182,0,2.403.327,3.667.978,1.263.652,2.301,1.834,3.116,3.545h.122v-3.667h8.066v31.227Zm-16.713-10.511c.102,1.02.306,1.926.611,2.72.306.795.733,1.427,1.283,1.895.55.469,1.272.703,2.169.703s1.64-.234,2.23-.703c.591-.468,1.06-1.109,1.406-1.925.345-.814.59-1.803.732-2.964s.214-2.434.214-3.819c0-3.992-.315-6.823-.946-8.494-.633-1.67-1.783-2.506-3.453-2.506-.938,0-1.691.205-2.261.611-.571.408-1.02,1.069-1.345,1.986-.326.916-.54,2.139-.642,3.666-.103,1.528-.152,3.392-.152,5.592,0,1.141.05,2.221.152,3.238Z"/>
    </g>
  </g>
  <polygon points="175.7 45.3 132.5 45.3 132.5 2.1 175.7 45.3" style="fill: #e0e0e0; stroke: #7f7f7f; stroke-linecap: round; stroke-linejoin: round; stroke-width: 4.039px;"/>
  <rect width="200" height="200" style="fill: none;"/>
</svg>`;let le=1;const ue=a((t,e)=>{const r="--inject-",n={clipPath:["clip-path"],"color-profile":null,cursor:null,filter:null,linearGradient:["fill","stroke"],marker:["marker","marker-end","marker-mid","marker-start"],mask:null,pattern:["fill","stroke"],radialGradient:["fill","stroke"]},o=r+le++,s=/url\("?#([a-zA-Z][\w:.-]*)"?\)/g,i=t.querySelectorAll("[id]");let c;const l=e?new Set:void 0,h=new Set,u=[];let d=!1,g,m;if(i.length){for(g=0;g<i.length;g++){const S=i[g].localName;ht(S,n)&&h.add(S)}h.forEach(S=>{(n[S]||[S]).forEach(function(p){u.indexOf(p)<0&&u.push(p)})}),u.length&&u.push("style");const f=t.getElementsByTagName("*");let w=t,y,A,b;for(g=-1;w!==null;){if(w.localName==="style")A=w.textContent,b=A&&A.replace(s,function(S,p){return l&&l.add(p),"url(#"+p+o+")"}),b!==A&&(w.textContent=b);else if(w.hasAttributes()){for(m=0;m<u.length;m++)y=u[m],A=w.getAttribute(y),b=A&&A.replace(s,function(S,p){return l&&l.add(p),"url(#"+p+o+")"}),b&&b!==A&&w.setAttribute(y,b);for(const S of["xlink:href","href"]){let p=w.getAttribute(S);p&&/^\s*#/.test(p)&&(p=p.trim(),w.setAttribute(S,p+o),l&&l.add(p.substring(1)))}}w=f.item(++g)}for(g=0;g<i.length;g++)c=i[g],(!l||l.has(c.id))&&(c.id+=o,d=!0)}return d},"makeIdsUnique"),de=a(async(t,{canvasSize:e,pathResolver:r})=>{const n=document.createElementNS("http://www.w3.org/2000/svg","g"),o=[],s=t.href.contents;let i=await r(s);i===void 0&&(console.error(`Could not resolve image path ${s}`),i=ce),o.push("href"),n.innerHTML=i;const c=n.querySelector("svg");return ue(n,!1),o.push(...F(t,c)),o.push(...U(t,e,n)),o.push(...At(t,e,n)),o.push(...$(t,n)),c.setAttribute("preserveAspectRatio",t.preserveAspectRatio.contents),o.push("preserveAspectRatio"),E(t,n,o),n},"RenderImage"),W=a((t,e,r,n,o,s)=>{const i=document.createElementNS("http://www.w3.org/2000/svg","marker");i.setAttribute("id",t),i.setAttribute("markerUnits","strokeWidth"),i.setAttribute("markerWidth",et(n.width*o).toString()),i.setAttribute("markerHeight",et(n.height*o).toString()),i.setAttribute("viewBox",n.viewbox),i.setAttribute("refX",n.refX.toString()),i.setAttribute("refY",n.refY.toString()),s?i.setAttribute("orient","auto"):i.setAttribute("orient","auto-start-reverse");const c=document.createElementNS("http://www.w3.org/2000/svg","path");return c.setAttribute("d",n.path),n.fillKind==="stroke"?(c.setAttribute("fill","none"),i.setAttribute("stroke",e),i.setAttribute("stroke-opacity",r.toString())):(c.setAttribute("fill",e),c.setAttribute("fill-opacity",r.toString())),n.style&&Object.entries(n.style).forEach(([l,h])=>{c.setAttribute(l,h)}),i.appendChild(c),i},"arrowHead"),he=a((t,e,r)=>{const n=[],[o,s]=[t.start.contents[0],t.start.contents[1]],[i,c]=[t.end.contents[0],t.end.contents[1]],l=t.startArrowheadSize.contents,h=t.endArrowheadSize.contents,u=t.strokeWidth.contents;n.push("start","end","startArrowhead","endArrowhead","startArrowheadSize","endArrowheadSize","strokeWidth");const d=Math.sqrt((o-i)**2+(s-c)**2);if(d===0)return[[[o,s],[i,c]],n];let g,m;if(e){const A=(t.flipStartArrowhead.contents?e.refX:e.width-e.refX)*l*u,b=A/d*(o-i),S=A/d*(s-c);[g,m]=[o-b,s-S]}else[g,m]=[o,s];let f,w;if(r){const y=(r.width-r.refX)*h*u;[f,w]=[i-y/d*(i-o),c-y/d*(c-s)]}else[f,w]=[i,c];return[[[g,m],[f,w]],n]},"makeRoomForArrows"),ge=a((t,{canvasSize:e,namespace:r,variation:n})=>{const o=_(t.startArrowhead.contents),s=_(t.endArrowhead.contents),[[[i,c],[l,h]],u]=he(t,o,s),d=Z(t.strokeColor.contents),g=P(t.strokeColor.contents),m=document.createElementNS("http://www.w3.org/2000/svg","g"),f=document.createElementNS("http://www.w3.org/2000/svg","line"),[w,y]=x([i,c],e),[A,b]=x([l,h],e);f.setAttribute("x1",w.toString()),f.setAttribute("y1",y.toString()),f.setAttribute("x2",A.toString()),f.setAttribute("y2",b.toString());const S=`${r}-${n}-${t.name.contents}`,p=S+"-startArrowId",M=S+"-endArrowId";if(o){const C=t.startArrowheadSize.contents,B=t.flipStartArrowhead.contents;m.appendChild(W(p,d,g,o,C,B))}if(s){const C=t.endArrowheadSize.contents;m.appendChild(W(M,d,g,s,C,!1))}return u.push("startArrowhead","flipStartArrowhead","endArrowhead","startArrowheadSize","endArrowheadSize"),u.push(...I(t,f)),o&&(f.setAttribute("marker-start",`url(#${p})`),u.push("startArrowhead")),s&&(f.setAttribute("marker-end",`url(#${M})`),u.push("endArrowhead")),m.appendChild(f),u.push(...$(t,m)),E(t,m,u),m},"RenderLine"),me=a((t,e)=>t.map(r=>{const{cmd:n,contents:o}=r;if(o.length===0&&n!=="Z")return console.error("WARNING: empty path"),"";const s=Tt.flatten(o.map(i=>{switch(i.tag){case"CoordV":return x([i.contents[0],i.contents[1]],e);case"ValueV":return i.contents}})).join(" ");return`${n} ${s}`}).join(" "),"toPathString"),pe=a(t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","filter");return e.setAttribute("id",t),e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("width","200%"),e.setAttribute("height","200%"),e.innerHTML=`
    <feOffset result="offOut" in="SourceAlpha" dx="5" dy="5" />
       <feGaussianBlur result="blurOut" in="offOut" stdDeviation="4" />
       <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />
       <feComponentTransfer>
         <feFuncA type="linear" slope="0.5" />
       </feComponentTransfer>
       <feMerge>
         <feMergeNode />
         <feMergeNode in="SourceGraphic" />
       </feMerge>
    `,e},"Shadow"),fe=a((t,{canvasSize:e})=>{const r=t.name.contents+"-startArrowId",n=t.name.contents+"-endArrowId",o=t.name.contents+"-shadow",s=document.createElementNS("http://www.w3.org/2000/svg","g"),i=Z(t.strokeColor.contents),c=P(t.strokeColor.contents),l=[],h=_(t.startArrowhead.contents),u=_(t.endArrowhead.contents);if(h){const g=t.name.contents+"-startArrowId",m=t.startArrowheadSize.contents,f=t.flipStartArrowhead.contents;s.appendChild(W(g,i,c,h,m,f))}if(u){const g=t.name.contents+"-endArrowId",m=t.endArrowheadSize.contents;s.appendChild(W(g,i,c,u,m,!1))}l.push("name","startArrowhead","flipStartArrowhead","endArrowhead"),s.appendChild(pe(o));const d=document.createElementNS("http://www.w3.org/2000/svg","path");return l.push(...R(t,d)),l.push(...I(t,d)),d.setAttribute("d",me(t.d.contents,e)),l.push("d"),h&&(d.setAttribute("marker-start",`url(#${r})`),l.push("startArrowhead")),u&&(d.setAttribute("marker-end",`url(#${n})`),l.push("endArrowhead")),s.appendChild(d),l.push(...$(t,s)),E(t,s,l),s},"RenderPath"),we=a((t,{canvasSize:e})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","polygon"),n=[];return n.push(...R(t,r)),n.push(...I(t,r)),n.push(...$(t,r)),n.push(...St(t,r)),n.push(...bt(t,e,r)),E(t,r,n),r},"RenderPolygon"),Se=a((t,{canvasSize:e})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","polyline"),n=[];return n.push(...R(t,r)),n.push(...I(t,r)),n.push(...$(t,r)),n.push(...St(t,r)),n.push(...bt(t,e,r)),E(t,r,n),r},"RenderPolyline"),Ae=a((t,{canvasSize:e})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=[];return n.push(...te(t,e,r)),n.push(...F(t,r)),n.push(...R(t,r)),n.push(...I(t,r)),n.push(...$(t,r)),n.push(...ee(t,r)),n.push(...U(t,e,r)),E(t,r,n),r},"RenderRectangle"),be=a((t,{canvasSize:e,labels:r})=>{const n=document.createElementNS("http://www.w3.org/2000/svg","text"),o=[];o.push("x","y"),o.push(...R(t,n)),o.push(...I(t,n)),o.push(...$(t,n)),o.push(...ne(t,n)),o.push(...U(t,e,n)),o.push(...oe(t,n));const s=t.name,i=r.get(s.contents),c=t.center,[l,h]=x([c.contents[0],c.contents[1]],e);if(i&&i.tag==="TextData"){const u=i.descent.contents,d=i.height.contents,g=h+(d/2-u);n.setAttribute("x",l.toString()),n.setAttribute("y",g.toString()),o.push(...F(t,n))}else n.setAttribute("x",l.toString()),n.setAttribute("y",h.toString());return n.setAttribute("font-size-adjust",t.fontSizeAdjust.contents),n.setAttribute("alignment-baseline",t.alignmentBaseline.contents),n.setAttribute("dominant-baseline",t.dominantBaseline.contents),n.setAttribute("ascent",t.ascent.contents.toString()),n.setAttribute("descent",t.descent.contents.toString()),n.setAttribute("text-anchor",t.textAnchor.contents.toString()),n.setAttribute("visibility",t.visibility.contents),o.push("fontSizeAdjust","alignmentBaseline","dominantBaseline","ascent","descent","textAnchor","visibility"),E(t,n,o),n},"RenderText"),ye=a((t,e,r,n)=>{const o=[...t.varyingValues];return{...t,params:J(o.length),varyingValues:o}},"dragUpdate"),ct=a(({clientX:t,clientY:e},r)=>{const n=r.getScreenCTM();return n!==null?{x:(t-n.e)/n.a,y:(e-n.f)/n.d}:{x:0,y:0}},"getPosition"),ve=a(async(t,e,r,n)=>{const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("version","1.2"),o.setAttribute("viewBox",`0 0 ${t.canvas.width} ${t.canvas.height}`);const s=a((c,l,h)=>{e(ye(t))},"onDrag"),i=t.computeShapes(t.varyingValues);return await yt(i,o,{labels:t.labelCache,canvasSize:t.canvas.size,variation:t.variation,namespace:n,texLabels:!1,pathResolver:r},{updateState:e,onDrag:s,parentSVG:o}),o},"toInteractiveSVG"),xe=a(async({varyingValues:t,canvas:e,computeShapes:r,labelCache:n,variation:o},s,i,c=!1)=>{const l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("version","1.2"),l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttribute("viewBox",`0 0 ${e.width} ${e.height}`);const h=r(t),u=h.map(k=>zt(k)),d=nt(u.map(k=>It(k))),g=nt(u.map(k=>Vt(k))),m=rt(u.map(k=>Bt(k))),f=rt(u.map(k=>Dt(k))),w=[d,g,m,f],[y,A,b,S]=(await Ft(w))(k=>k.val),[p,M]=x([y,A],[e.width,e.height]),[C,B]=x([b,S],[e.width,e.height]),O=[p,B],L=[C-p,M-B];l.setAttribute("penrose","0");const X=document.createElementNS("https://penrose.cs.cmu.edu/metadata","penrose"),q=document.createElementNS("https://penrose.cs.cmu.edu/croppedViewBox","croppedViewBox");return q.insertAdjacentText("afterbegin",`${O[0]} ${O[1]} ${L[0]} ${L[1]}`),X.appendChild(q),l.appendChild(X),await yt(h,l,{labels:n,canvasSize:e.size,variation:o,namespace:i,texLabels:c,pathResolver:s},void 0),l},"toSVG"),ke=a(async(t,e,r)=>{const n=document.createElementNS("http://www.w3.org/2000/svg","g"),o=t.clipPath.contents;let s,i;if(o.tag==="Clip"){const l=o.contents;s=l.name.contents;const h=await Y(l,e,r),u=document.createElementNS("http://www.w3.org/2000/svg","clipPath");i=e.namespace+s+"-clip",u.setAttribute("id",i),u.appendChild(h),n.appendChild(u)}const c=t.shapes.contents;for(const l of c){const h=l.name.contents;if(o.tag==="Clip"){if(h!==s){const u=await Y(l,e,r),d=document.createElementNS("http://www.w3.org/2000/svg","g");d.appendChild(u),d.setAttribute("clip-path",`url(#${i})`),n.appendChild(d)}}else{const u=await Y(l,e,r);n.appendChild(u)}}return E(t,n,[...$(t,n),"shapes","clipPath"]),n},"RenderGroup"),Ee=a(async(t,e)=>{switch(t.shapeType){case"Circle":return se(t,e);case"Ellipse":return ie(t,e);case"Equation":return ae(t,e);case"Image":return de(t,e);case"Line":return ge(t,e);case"Path":return fe(t,e);case"Polygon":return we(t,e);case"Polyline":return Se(t,e);case"Rectangle":return Ae(t,e);case"Text":return be(t,e)}},"RenderShapeSvg"),Y=a(async(t,e,r)=>{if(t.shapeType==="Group")return await ke(t,e,r);{const n=await Ee(t,e);if(r){const o=document.createElementNS("http://www.w3.org/2000/svg","g");Ot(t)?o.setAttribute("pointer-events","visibleStroke"):Lt(t)?o.setAttribute("pointer-events","bounding-box"):o.setAttribute("pointer-events","auto"),o.appendChild(n);const s=a(i=>{const{clientX:c,clientY:l}=i,{x:h,y:u}=ct({clientX:c,clientY:l},r.parentSVG),{width:d,height:g,x:m,y:f}=i.target.getBBox({stroke:!0}),w=h-m,y=e.canvasSize[0]-d+(h-m),A=u-f,b=e.canvasSize[1]-g+(u-f);o.setAttribute("opacity","0.5");let S=0,p=0;const M=a(B=>{const{x:O,y:L}=ct(B,r.parentSVG),X=lt(O,w,y),q=lt(L,A,b);S=X-h,p=u-q,o.setAttribute("transform",`translate(${S},${-p})`)},"onMouseMove"),C=a(()=>{o.setAttribute("opacity","1"),document.removeEventListener("mouseup",C),document.removeEventListener("mousemove",M),r.onDrag(t.name.contents,S,p)},"onMouseUp");document.addEventListener("mouseup",C),document.addEventListener("mousemove",M)},"onMouseDown");return o.addEventListener("mousedown",s),o}else return n}},"RenderShape"),yt=a(async(t,e,r,n)=>{for(const o of t){const s=await Y(o,r,n);e.appendChild(s)}},"RenderShapes"),lt=a((t,e,r)=>Math.min(Math.max(t,e),r),"clamp"),$e=a(t=>{const e=Xt(t.variation);return ft({...t,varyingValues:t.inputs.map(({meta:r})=>r.init.tag==="Sampled"?r.init.sampler(e):r.init.pending),currentStageIndex:0,params:J(t.varyingValues.length)})},"resample"),vt=a((t,e)=>{const{constraintSets:r,optStages:n,currentStageIndex:o}=t,s=n[o],i=j(r.get(s),()=>`missing stage: ${s}`),c=new Float64Array(t.varyingValues),l=_t((h,u,d)=>t.gradient(i,h,u,d).phi,c,t.params,e.until);return l.optStatus==="Error"?N({errorType:"RuntimeError",...Wt("",t)}):V({...t,varyingValues:Array.from(c),params:l})},"step"),Ce=a((t,e=1e4)=>{let r=0;const n=vt(t,{until:()=>r++>=e});if(n.isErr())return n;{const o=n.value;if(H(o)&&!Q(o)){const s=xt(o);return V(s)}else return n}},"stepTimes"),xt=a(t=>Q(t)?t:{...t,currentStageIndex:t.currentStageIndex+1,params:J(t.varyingValues.length)},"nextStage"),Ne=a(t=>{let e=t;for(;!H(e)||!Q(e);){H(e)&&(e=xt(e));const r=vt(e,{until:()=>!1});if(r.isOk())e=r.value;else return r}return V(e)},"optimize"),Me=a(async t=>{const e=qt(t.domain);if(e.isErr())return N(e.error);const r=Yt(t.substance,e.value);if(r.isErr())return N(r.error);const n=await jt(t.variation,t.style,t.excludeWarnings??[],r.value,e.value);if(n.isErr())return n;{const o=n.value,s=Pt(),i=await mt(o.shapes,s);return i.isErr()?N(i.error):V(ft({...o,labelCache:i.value}))}},"compile"),H=a(t=>t.params.optStatus==="EPConverged","isOptimized"),Q=a(t=>t.currentStageIndex===t.optStages.length-1,"finalStage");async function ut(t){const e=await fetch(t);if(!e.ok){console.error(`could not fetch ${t}`);return}return await e.text()}a(ut,"fetchResolver");const tt=class tt extends ot.Component{canvasRef=ot.createRef();penroseState=void 0;timerID=void 0;constructor(e){super(e),this.state={error:void 0}}compile=async()=>{this.penroseState=void 0,this.setState({error:void 0});const e=await Me(this.props);e.isOk()?(this.penroseState=e.value,this.setState({error:void 0})):this.setState({error:e.error})};converge=async()=>{if(this.penroseState){const e=Ne(this.penroseState);e.isOk()?this.penroseState=e.value:this.setState({error:e.error})}};tick=()=>{if(this.props.animate&&this.penroseState&&!H(this.penroseState)){const e=Ce(this.penroseState,this.props.stepSize??1);e.isErr()?this.setState({error:e.error}):this.penroseState=e.value,this.renderCanvas()}};componentDidMount=async()=>{await this.compile(),this.props.animate||await this.converge(),this.renderCanvas(),this.timerID=window.setInterval(()=>this.tick(),1e3/60)};componentDidUpdate=async e=>{if(this.props.domain!==e.domain||this.props.substance!==e.substance||this.props.style!==e.style){await this.compile(),this.props.animate||await this.converge(),this.renderCanvas();return}if(this.penroseState&&!this.state.error){if(this.props.variation!==e.variation||this.props.animate!==e.animate){this.penroseState.variation=this.props.variation,this.penroseState=$e(this.penroseState),this.props.animate||await this.converge(),this.renderCanvas();return}else if(this.props.interactive!==e.interactive){this.renderCanvas();return}}};componentWillUnmount=()=>{clearInterval(this.timerID)};renderCanvas=async()=>{if(this.canvasRef.current===null)return D("div",{children:"rendering..."});{const e=this.canvasRef.current;if(this.penroseState){const r=await (this.props.interactive===!1?xe(this.penroseState,this.props.imageResolver??ut,this.props.name??""):ve(this.penroseState,async n=>{this.penroseState=n,this.props.animate||await this.converge(),this.renderCanvas()},this.props.imageResolver??ut,this.props.name??""));r.setAttribute("width","100%"),r.setAttribute("height","100%"),e.firstChild!==null?e.replaceChild(r,e.firstChild):e.appendChild(r),this.props.onFrame&&this.props.onFrame(this.penroseState)}else return D("div",{children:"rendering..."})}};render=()=>{const{error:e}=this.state;return st(Gt,{children:[!e&&D("div",{style:{width:"100%",height:"100%"},ref:this.canvasRef}),e&&st("div",{style:{padding:"1em",height:"100%"},children:[D("div",{style:{fontWeight:700},children:"1 error:"}),D("div",{style:{fontFamily:"monospace"},children:Ht(e).toString().split(`
`).map((r,n)=>D("p",{style:{margin:0},children:r},`err-ln-${n}`))})]})]})}};a(tt,"Simple");G=tt;try{G.displayName="Simple",G.__docgenInfo={description:"",displayName:"Simple",props:{domain:{defaultValue:null,description:"",name:"domain",required:!0,type:{name:"string"}},substance:{defaultValue:null,description:"",name:"substance",required:!0,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"string"}},variation:{defaultValue:null,description:"",name:"variation",required:!0,type:{name:"string"}},excludeWarnings:{defaultValue:null,description:"",name:"excludeWarnings",required:!1,type:{name:"string[]"}},stepSize:{defaultValue:null,description:"",name:"stepSize",required:!1,type:{name:"number"}},interactive:{defaultValue:null,description:"",name:"interactive",required:!1,type:{name:"boolean"}},animate:{defaultValue:null,description:"",name:"animate",required:!1,type:{name:"boolean"}},onFrame:{defaultValue:null,description:"",name:"onFrame",required:!1,type:{name:"((frame: State) => void)"}},imageResolver:{defaultValue:null,description:"",name:"imageResolver",required:!1,type:{name:"PathResolver"}},name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}}}}}catch{}});export{G as S,__tla};