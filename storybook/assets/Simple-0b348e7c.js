var te=Object.defineProperty;var ee=(P,z,j)=>z in P?te(P,z,{enumerable:!0,configurable:!0,writable:!0,value:j}):P[z]=j;var A=(P,z,j)=>(ee(P,typeof z!="symbol"?z+"":z,j),j);import{j as N}from"./jsx-runtime-1438501e.js";import{b as ne,R as re,T as se,A as ie,s as ae,m as oe,g as y,e as E,a as mt,o as M,u as H,i as ft,t as X,c as G,d as k,f as U,r as wt,_ as ce,h as le,j as vt,k as he,n as ue,p as bt,q as pe,v as de,w as ge,x as me,y as St,z as fe,B as we,C as ve,D as be,E as Se,F as ye,__tla as Ae}from"./svg-7169eb98.js";import{R as yt}from"./index-f46741a2.js";let K,ke=Promise.all([(()=>{try{return Ae}catch{}})()]).then(async()=>{const P=()=>{const t=ne();re(t);const e=new se({packages:ie,macros:{textsc:["\\style{font-variant-caps: small-caps}{\\text{#1}}",1]},inlineMath:[["$","$"],["\\(","\\)"]],processEscapes:!0,formatError:(n,i)=>{throw Error(i.message)}}),s=new ae.SVG({fontCache:"none"}),r=oe.mathjax.document("",{InputJax:e,OutputJax:s});return n=>{try{const i=r.convert(n,{});return M(i.firstChild)}catch(i){return E(i.message)}}},z=t=>{const e=/^(\d+(?:\.\d+)?)\s*(px|in|cm|mm)$/,s=t.match(e);if(!s)return;const r=parseFloat(s[1]),n=s[2];return{number:r,unit:n}},j=(t,e)=>({px:1,in:96,cm:37.79527559055118,mm:3.7795275590551185})[e]*t,At=async(t,e)=>new Promise(s=>{const r=y(t.string,""),n=y(t.fontSize,"");(n===""||r==="")&&s(E(`Label 'string' and 'fontSize' must be non-empty and non-optimized for ${t.name.contents}`));const i=e(r);if(i.isErr()){s(E(`MathJax could not render $${r}$: ${i.error}`));return}const a=i.value,o=a.getAttribute("viewBox");if(o===null){s(E(`No ViewBox found for MathJax output $${r}$`));return}const c=o.split(" "),l=parseFloat(c[2])/1e3,u=parseFloat(c[3])/1e3,h=-parseFloat(a.style.verticalAlign),p=parseFloat(a.getAttribute("height")),g=z(n);if(g){const{number:m,unit:d}=g,b=I=>I*j(m,d),S=b(l),w=b(u),v=h/p*w,f=w-v;s(M({body:a,width:S,height:w,descent:v,ascent:f}))}else{s(E('Invalid font size format. Only "px", "in", "cm", and "mm" units are supported.'));return}}),B=t=>({tag:"FloatV",contents:t}),Q=(t,e,s,r)=>({tag:"TextData",width:B(t),height:B(e),descent:B(s),ascent:B(r)}),kt=(t,e,s,r,n)=>({tag:"EquationData",width:B(t),height:B(e),ascent:B(s),descent:B(r),rendered:n}),tt=t=>{const e=y(t.fontFamily),s=y(t.fontSize),r=y(t.fontStretch),n=y(t.fontStyle),i=y(t.fontVariant),a=y(t.fontWeight),o=y(t.lineHeight),c=`${r} ${n} ${i} ${a} ${s} ${e}`;return o!==""?c.concat(`/${o}`):c},et=async(t,e)=>{const s=new Map;for(const r of t)if(r.shapeType==="Equation"){const n=y(r.name),i=await At(r,e);if(i.isErr())return E({errorType:"SubstanceError",tag:"Fatal",message:i.error});const{body:a,width:o,height:c,ascent:l,descent:u}=i.value,h=kt(o===1/0?0:o,c===1/0?0:c,l,u,a);s.set(n,h)}else if(r.shapeType==="Text"){const n=y(r.name);let i;const a=xt(y(r.string),tt(r));a.width&&a.height?i=Q(a.width,a.height,a.actualDescent,a.actualAscent):i=Q(0,0,0,0),s.set(n,i)}else if(r.shapeType==="Group"){const n=mt(r.shapes),i=await et(n,e);if(i.isErr())return i;for(const[a,o]of i.value.entries())s.set(a,o)}return M(s)};function xt(t,e){const s=document.createElement("canvas"),r=s.getContext("2d");r.textBaseline="alphabetic",r.font=e;const n=r.measureText(t);return s.remove(),{width:Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight),height:Math.abs(n.actualBoundingBoxAscent)+Math.abs(n.actualBoundingBoxDescent),actualDescent:Math.abs(n.actualBoundingBoxDescent),actualAscent:Math.abs(n.actualBoundingBoxAscent)}}const R=(t,e,s,r)=>{if(typeof s.contents!="number"&&s.contents.tag==="Var"){const{index:n,meta:i}=H(e.get(s.contents),()=>"missing input");i.init.tag==="Pending"&&(t[n]=r.contents)}},nt=(t,e,s,r)=>{for(const n of t)if(n.shapeType==="Group"){const i=mt(n.shapes);nt(i,e,s,r)}else if(n.shapeType==="Equation"){const i=H(s.get(n.name.contents),()=>`missing label: ${n.name.contents}. Label cache: ${[...s.keys()].join(" ")}`);if(i.tag!=="EquationData")throw Error(`for ${n.shapeType} ${n.name.contents} got unexpected ${i.tag}`);R(e,r,n.width,i.width),R(e,r,n.height,i.height),R(e,r,n.ascent,i.ascent),R(e,r,n.descent,i.descent)}else if(n.shapeType==="Text"){const i=H(s.get(n.name.contents),()=>`missing label: ${n.name.contents}`);if(i.tag!=="TextData")throw Error(`for ${n.shapeType} ${n.name.contents} got unexpected ${i.tag}`);R(e,r,n.width,i.width),R(e,r,n.height,i.height),R(e,r,n.ascent,i.ascent),R(e,r,n.descent,i.descent)}},rt=t=>{const e=[...t.varyingValues],s=new Map(t.inputs.map(({handle:r,meta:n},i)=>[r,{index:i,meta:n}]));return nt(t.shapes,e,t.labelCache,s),{...t,varyingValues:e}},st={accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",overlinePosition:"overline-position",overlineThickness:"overline-thickness",panose1:"panose-1",paintOrder:"paint-order",pointerEvents:"pointer-events",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDasharray:"stroke-dasharray",strokeDashoffset:"stroke-dashoffset",strokeLinecap:"stroke-linecap",strokeLinejoin:"stroke-linejoin",strokeMiterlimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode"},x=(t,e,s)=>{const r=["name","ensureOnCanvas"],n=new Set(s.concat(r));for(const[i,a]of t.passthrough)if(!(a.tag==="StrV"&&a.contents===""||n.has(i)))if(ft(i,st)){const o=st[i];e.hasAttribute(o)||e.setAttribute(o,a.contents.toString())}else if(i==="style"&&a.contents!==""){const o=e.getAttribute(i);o===null?e.setAttribute(i,a.contents.toString()):e.setAttribute(i,`${o}${a.contents.toString()}`)}else e.hasAttribute(i)||e.setAttribute(i,a.contents.toString())},T=(t,e)=>{const s=t.fillColor,r=X(s.contents);return e.setAttribute("fill",G(s.contents)),s.contents.tag!=="NONE"&&e.setAttribute("fill-opacity",r.toString()),["fillColor"]},it=(t,e,s)=>{const r=t.center,[n,i]=k([r.contents[0],r.contents[1]],e);return s.setAttribute("cx",n.toString()),s.setAttribute("cy",i.toString()),["center"]},at=(t,e)=>{let s=t.scale.contents;s=s||1;let r=e.getAttribute("transform");return r=r===null?`scale(${s})`:r+`scale{${s}}`,e.setAttribute("transform",r),["scale"]},ot=(t,e,s)=>{const r=t.center,[n,i]=k([r.contents[0],r.contents[1]],e),a=t.width,o=t.height;let c=s.getAttribute("transform");return c=c===null?`translate(${n-a.contents/2}, ${i-o.contents/2})`:c+`translate(${n-a.contents/2}, ${i-o.contents/2})`,s.setAttribute("transform",c),["center","width","height"]},$t=(t,e,s)=>{const r=t.center,[n,i]=k([r.contents[0],r.contents[1]],e),a=t.width,o=t.height;return s.setAttribute("x",(n-a.contents/2).toString()),s.setAttribute("y",(i-o.contents/2).toString()),["center","width","height"]},O=(t,e,s)=>{t.width,t.height;const r=t.center,n=t.rotation.contents,[i,a]=k([r.contents[0],r.contents[1]],e);let o=s.getAttribute("transform");return o=o===null?`rotate(${n}, ${i}, ${a})`:o+`rotate(${n}, ${i}, ${a})`,s.setAttribute("transform",o),["rotation","center","width","height"]},V=(t,e)=>{const s=t.width,r=t.height;return e.setAttribute("width",Math.max(s.contents,0).toString()),e.setAttribute("height",Math.max(r.contents,0).toString()),["width","height"]},Ct=(t,e)=>{const s=t.cornerRadius;return e.setAttribute("rx",s.contents.toString()),["cornerRadius"]},Et=(t,e)=>{const s=t.string,r=document.createTextNode(s.contents.toString());return e.appendChild(r),["string"]},zt="7,5",D=(t,e)=>{const s=[],r=t.strokeColor,n=X(r.contents),i=t.strokeWidth.contents;return e.setAttribute("stroke",G(r.contents)),s.push("strokeColor","strokeWidth"),r.contents.tag!=="NONE"&&(e.setAttribute("stroke-opacity",n.toString()),e.setAttribute("stroke-width",i.toString()),"strokeDasharray"in t&&t.strokeDasharray.contents!==""?(e.setAttribute("stroke-dasharray",t.strokeDasharray.contents),s.push("strokeDasharray")):"strokeStyle"in t&&t.strokeStyle.contents==="dashed"&&(e.setAttribute("stroke-dasharray",zt.toString()),s.push("strokeDasharray","strokeStyle")),"strokeLinecap"in t&&t.strokeLinecap.contents!==""&&(e.setAttribute("stroke-linecap",t.strokeLinecap.contents),s.push("strokeLinecap"))),s},$=(t,e,s)=>{const r=t.name,n=document.createElementNS("http://www.w3.org/2000/svg","title");return n.textContent=r.contents,e.appendChild(n),s&&s.set(r.contents,e),["name"]},Tt=(t,e)=>{const s=tt(t),r=e.getAttribute("style");return e.setAttribute("style",r?`${r}; font: ${s};`:`font: ${s};`),["fontFamily","fontSize","fontStretch","fontStyle","fontVariant","fontWeight","lineHeigh"]},ct=(t,e,s)=>{const r=t.points.contents.map(n=>k([n[0],n[1]],e));return s.setAttribute("points",r.toString()),["points"]},Nt=(t,{canvasSize:e,titleCache:s})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","circle"),n=[];return n.push(...T(t,r)),n.push(...it(t,e,r)),n.push(...D(t,r)),n.push(...$(t,r,s)),r.setAttribute("r",Math.max(0,t.r.contents).toString()),n.push("r"),x(t,r,n),r},Bt=(t,{canvasSize:e,titleCache:s})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),n=[];return n.push(...T(t,r)),n.push(...it(t,e,r)),n.push(...D(t,r)),n.push(...$(t,r,s)),r.setAttribute("rx",Math.max(t.rx.contents,0).toString()),n.push("rx"),r.setAttribute("ry",Math.max(t.ry.contents,0).toString()),n.push("ry"),x(t,r,n),r},J=(t,[e,s],r)=>{const n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.textContent=t,T(r,n),V(r,n),n.setAttribute("x",`${e}`),n.setAttribute("y",`${s}`),n.setAttribute("alignment-baseline","alphabetic"),n.setAttribute("dominant-baseline","alphabetic"),n.setAttribute("text-anchor","middle"),n},Rt=(t,e)=>{const{canvasSize:s,labels:r,texLabels:n}=e,{center:i}=t,[a,o]=k([i.contents[0],i.contents[1]],s);if(n){const h=o+t.height.contents/2-t.descent.contents;let p=J(`$${y(t.string)}$`,[a,h],t);for(const[g,m]of t.passthrough)g==="texContourColor"&&m.contents!==""&&(p=J(`\\contour{${m.contents}}{$${y(t.string)}$}`,[a,h],t));return p}const c=document.createElementNS("http://www.w3.org/2000/svg","g"),l=[];l.push(...O(t,s,c)),l.push(...ot(t,s,c)),l.push(...$(t,c,e.titleCache));const u=r.get(y(t.name));if(u&&u.tag==="EquationData"){const h=u.rendered.cloneNode(!0),p=h.getElementsByTagName("g")[0];l.push(...T(t,p)),l.push(...V(t,h)),p.setAttribute("stroke","none"),p.setAttribute("stroke-width","0");const g=t.fontSize;return h.setAttribute("style",`font-size: ${g.contents}`),c.appendChild(h),x(t,c,l),c}else return J(y(t.string),[a,o],t)},Dt=`<?xml version="1.0" encoding="UTF-8"?>
<svg id="uuid-14337243-9689-41d7-b7ce-2960e3a1016a" data-name="uuid-95bf6e06-fb2b-43f6-8f44-0afdfcaaf242" xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200">
  <polygon points="132.5 2.1 175.7 45.3 175.7 197.9 24.3 197.9 24.3 2.1 132.5 2.1" style="fill: #e0e0e0; stroke: #7f7f7f; stroke-width: 4.039px;"/>
  <g>
    <path d="m157.4,77.75l-46.2-33.4-42.1,30.4m42.2-46.9l-46.4,33.5,15.7,49.1m38.2,0h-51.4l-18-54.1m7.8,66.9h57.1l17.1-48.4m-7.3,62l17.9-54.1-42.2-30.9m38,85H61.6l-23.4-72.3,61.5-44.9,62.1,44.9-24,72.3Z" style="fill: none; stroke: #ffb6b6; stroke-width: 4.034px;"/>
    <path d="m77,66.3c0-3.4.5-6.5,1.4-9.4s2.3-5.3,4.2-7.3c1.8-2,4.2-3.6,7-4.8s6.1-1.7,9.7-1.7c8,0,13.9,2,17.9,5.9,3.9,3.9,5.9,9.2,5.9,15.8,0,3.2-.5,6.1-1.5,8.8s-2.9,5.6-5.6,8.8l-4.5,5.1c-2,2.2-3.4,4.2-4.2,6-.9,1.8-1.3,4.1-1.3,7h0c0,.9-.8,1.7-1.7,1.7h-10.7c-.9,0-1.7-.8-1.7-1.7v-2.7c0-3.8.5-6.9,1.6-9.5s2.9-5.3,5.4-8.2l4.3-4.8c1.6-1.7,2.7-3.6,3.3-5.6.6-2,1-4.1,1-6.4,0-2.9-.6-5.2-1.9-6.9-1.3-1.8-3.2-2.6-5.7-2.6-2.9,0-4.9,1.1-6.1,3.4-1.2,2.3-1.9,5.3-1.9,9v1.1c0,.9-.8,1.7-1.7,1.7h-11.6c-.9,0-1.7-.8-1.7-1.7v-1h.1Zm28,58.1h-12.2c-.9,0-1.7-.8-1.7-1.7v-11.5c0-.9.8-1.7,1.7-1.7h12.2c.9,0,1.7.8,1.7,1.7v11.5c0,1-.8,1.7-1.7,1.7Z" style="fill: red;"/>
  </g>
  <g style="isolation: isolate;">
    <g style="isolation: isolate;">
      <path d="m58.52,179.451h-8.066v-9.533h8.066v9.533Z"/>
      <path d="m70.802,169.795c0,1.427.376,2.577,1.131,3.453.753.876,1.843,1.313,3.269,1.313,1.303,0,2.342-.325,3.117-.978.773-.651,1.161-1.629,1.161-2.934,0-1.059-.306-1.863-.917-2.414-.611-.55-1.324-.987-2.139-1.313l-5.928-2.139c-2.322-.814-4.074-1.965-5.255-3.453-1.182-1.486-1.772-3.392-1.772-5.713,0-1.345.224-2.617.672-3.819.448-1.201,1.161-2.251,2.139-3.147.978-.896,2.23-1.609,3.758-2.139s3.371-.795,5.53-.795c3.829,0,6.661.815,8.494,2.444,1.833,1.63,2.75,3.933,2.75,6.905v1.345h-7.578c0-1.711-.275-2.964-.825-3.758-.55-.795-1.519-1.192-2.903-1.192-1.06,0-1.986.296-2.781.887-.794.591-1.191,1.477-1.191,2.658,0,.815.254,1.549.764,2.199.509.652,1.477,1.202,2.903,1.65l5.072,1.711c2.647.896,4.522,2.068,5.622,3.514,1.1,1.447,1.65,3.413,1.65,5.897,0,1.752-.306,3.27-.917,4.553-.611,1.283-1.457,2.353-2.536,3.208-1.08.855-2.363,1.467-3.85,1.833-1.488.367-3.127.55-4.919.55-2.363,0-4.329-.224-5.897-.672-1.569-.448-2.811-1.12-3.728-2.017-.917-.896-1.558-1.986-1.925-3.27s-.55-2.719-.55-4.308v-1.161h7.578v1.1Z"/>
      <path d="m115.778,146.574l-8.25,32.877h-9.778l-8.494-32.877h8.8l4.705,23.527h.123l4.461-23.527h8.434Z"/>
      <path d="m143.52,177.8c0,4.237-1.049,7.415-3.146,9.533-2.099,2.118-5.612,3.178-10.541,3.178-3.586,0-6.347-.764-8.28-2.291-1.936-1.528-2.903-3.697-2.903-6.509h8.066c0,1.06.428,1.895,1.283,2.506.407.284.846.509,1.314.672.468.162.967.245,1.497.245,1.711,0,2.912-.551,3.605-1.65.692-1.1,1.038-2.466,1.038-4.095v-4.338h-.122c-.855,1.222-1.904,2.199-3.146,2.933-1.243.733-2.536,1.101-3.881,1.101-3.341,0-5.856-1.273-7.547-3.819-1.691-2.546-2.536-6.814-2.536-12.803,0-1.914.112-3.87.336-5.866s.692-3.799,1.406-5.408c.712-1.609,1.751-2.923,3.116-3.941,1.364-1.019,3.188-1.528,5.469-1.528,1.182,0,2.403.327,3.667.978,1.263.652,2.301,1.834,3.116,3.545h.122v-3.667h8.066v31.227Zm-16.713-10.511c.102,1.02.306,1.926.611,2.72.306.795.733,1.427,1.283,1.895.55.469,1.272.703,2.169.703s1.64-.234,2.23-.703c.591-.468,1.06-1.109,1.406-1.925.345-.814.59-1.803.732-2.964s.214-2.434.214-3.819c0-3.992-.315-6.823-.946-8.494-.633-1.67-1.783-2.506-3.453-2.506-.938,0-1.691.205-2.261.611-.571.408-1.02,1.069-1.345,1.986-.326.916-.54,2.139-.642,3.666-.103,1.528-.152,3.392-.152,5.592,0,1.141.05,2.221.152,3.238Z"/>
    </g>
  </g>
  <polygon points="175.7 45.3 132.5 45.3 132.5 2.1 175.7 45.3" style="fill: #e0e0e0; stroke: #7f7f7f; stroke-linecap: round; stroke-linejoin: round; stroke-width: 4.039px;"/>
  <rect width="200" height="200" style="fill: none;"/>
</svg>`;let Pt=1;const jt=(t,e)=>{const s="--inject-",r={clipPath:["clip-path"],"color-profile":null,cursor:null,filter:null,linearGradient:["fill","stroke"],marker:["marker","marker-end","marker-mid","marker-start"],mask:null,pattern:["fill","stroke"],radialGradient:["fill","stroke"]},n=s+Pt++,i=/url\("?#([a-zA-Z][\w:.-]*)"?\)/g,a=t.querySelectorAll("[id]");let o;const c=e?new Set:void 0,l=new Set,u=[];let h=!1,p,g;if(a.length){for(p=0;p<a.length;p++){const v=a[p].localName;ft(v,r)&&l.add(v)}l.forEach(v=>{(r[v]||[v]).forEach(function(f){u.indexOf(f)<0&&u.push(f)})}),u.length&&u.push("style");const m=t.getElementsByTagName("*");let d=t,b,S,w;for(p=-1;d!==null;){if(d.localName==="style")S=d.textContent,w=S&&S.replace(i,function(v,f){return c&&c.add(f),"url(#"+f+n+")"}),w!==S&&(d.textContent=w);else if(d.hasAttributes()){for(g=0;g<u.length;g++)b=u[g],S=d.getAttribute(b),w=S&&S.replace(i,function(v,f){return c&&c.add(f),"url(#"+f+n+")"}),w&&w!==S&&d.setAttribute(b,w);for(const v of["xlink:href","href"]){let f=d.getAttribute(v);f&&/^\s*#/.test(f)&&(f=f.trim(),d.setAttribute(v,f+n),c&&c.add(f.substring(1)))}}d=m.item(++p)}for(p=0;p<a.length;p++)o=a[p],(!c||c.has(o.id))&&(o.id+=n,h=!0)}return h},It=async(t,{canvasSize:e,pathResolver:s,titleCache:r})=>{const n=document.createElementNS("http://www.w3.org/2000/svg","g"),i=[],a=t.href.contents;let o=await s(a);o===void 0&&(console.error(`Could not resolve image path ${a}`),o=Dt),i.push("href"),n.innerHTML=o;const c=n.querySelector("svg");return jt(n,!1),i.push(...V(t,c)),i.push(...O(t,e,n)),i.push(...ot(t,e,n)),i.push(...$(t,n,r)),c.setAttribute("preserveAspectRatio",t.preserveAspectRatio.contents),i.push("preserveAspectRatio"),x(t,n,i),n},F=(t,e,s,r,n,i)=>{const a=document.createElementNS("http://www.w3.org/2000/svg","marker");a.setAttribute("id",t),a.setAttribute("markerUnits","strokeWidth"),a.setAttribute("markerWidth",wt(r.width*n).toString()),a.setAttribute("markerHeight",wt(r.height*n).toString()),a.setAttribute("viewBox",r.viewbox),a.setAttribute("refX",r.refX.toString()),a.setAttribute("refY",r.refY.toString()),i?a.setAttribute("orient","auto"):a.setAttribute("orient","auto-start-reverse");const o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",r.path),r.fillKind==="stroke"?(o.setAttribute("fill","none"),a.setAttribute("stroke",e),a.setAttribute("stroke-opacity",s.toString())):(o.setAttribute("fill",e),o.setAttribute("fill-opacity",s.toString())),r.style&&Object.entries(r.style).forEach(([c,l])=>{o.setAttribute(c,l)}),a.appendChild(o),a},Mt=(t,e,s)=>{const r=[],[n,i]=[t.start.contents[0],t.start.contents[1]],[a,o]=[t.end.contents[0],t.end.contents[1]],c=t.startArrowheadSize.contents,l=t.endArrowheadSize.contents,u=t.strokeWidth.contents;r.push("start","end","startArrowhead","endArrowhead","startArrowheadSize","endArrowheadSize","strokeWidth");const h=Math.sqrt((n-a)**2+(i-o)**2);if(h===0)return[[[n,i],[a,o]],r];let p,g;if(e){const b=(t.flipStartArrowhead.contents?e.refX:e.width-e.refX)*c*u,S=b/h*(n-a),w=b/h*(i-o);[p,g]=[n-S,i-w]}else[p,g]=[n,i];let m,d;if(s){const b=(s.width-s.refX)*l*u;[m,d]=[a-b/h*(a-n),o-b/h*(o-i)]}else[m,d]=[a,o];return[[[p,g],[m,d]],r]},Vt=(t,{canvasSize:e,namespace:s,variation:r,titleCache:n})=>{const i=U(t.startArrowhead.contents),a=U(t.endArrowhead.contents),[[[o,c],[l,u]],h]=Mt(t,i,a),p=G(t.strokeColor.contents),g=X(t.strokeColor.contents),m=document.createElementNS("http://www.w3.org/2000/svg","g"),d=document.createElementNS("http://www.w3.org/2000/svg","line"),[b,S]=k([o,c],e),[w,v]=k([l,u],e);d.setAttribute("x1",b.toString()),d.setAttribute("y1",S.toString()),d.setAttribute("x2",w.toString()),d.setAttribute("y2",v.toString());const f=`${s}-${r}-${t.name.contents}`,I=f+"-startArrowId",Z=f+"-endArrowId";if(i){const q=t.startArrowheadSize.contents,_=t.flipStartArrowhead.contents;m.appendChild(F(I,p,g,i,q,_))}if(a){const q=t.endArrowheadSize.contents;m.appendChild(F(Z,p,g,a,q,!1))}return h.push("startArrowhead","flipStartArrowhead","endArrowhead","startArrowheadSize","endArrowheadSize"),h.push(...D(t,d)),i&&(d.setAttribute("marker-start",`url(#${I})`),h.push("startArrowhead")),a&&(d.setAttribute("marker-end",`url(#${Z})`),h.push("endArrowhead")),m.appendChild(d),h.push(...$(t,m,n)),x(t,m,h),m},qt=(t,e)=>t.map(s=>{const{cmd:r,contents:n}=s;if(n.length===0&&r!=="Z")return console.error("WARNING: empty path"),"";const i=ce.flatten(n.map(a=>{switch(a.tag){case"CoordV":return k([a.contents[0],a.contents[1]],e);case"ValueV":return a.contents}})).join(" ");return`${r} ${i}`}).join(" "),Ot=(t,{canvasSize:e,titleCache:s})=>{const r=G(t.strokeColor.contents),n=X(t.strokeColor.contents),i=[],a=document.createElementNS("http://www.w3.org/2000/svg","path");i.push(...T(t,a)),i.push(...D(t,a)),a.setAttribute("d",qt(t.d.contents,e)),i.push("d");let o;const c=U(t.startArrowhead.contents),l=U(t.endArrowhead.contents);if(c||l){const u=document.createElementNS("http://www.w3.org/2000/svg","g"),h=t.name.contents+"-startArrowId",p=t.name.contents+"-endArrowId";if(c){const g=t.name.contents+"-startArrowId",m=t.startArrowheadSize.contents,d=t.flipStartArrowhead.contents;u.appendChild(F(g,r,n,c,m,d))}if(l){const g=t.name.contents+"-endArrowId",m=t.endArrowheadSize.contents;u.appendChild(F(g,r,n,l,m,!1))}i.push("name","startArrowhead","flipStartArrowhead","endArrowhead"),c&&(a.setAttribute("marker-start",`url(#${h})`),i.push("startArrowhead")),l&&(a.setAttribute("marker-end",`url(#${p})`),i.push("endArrowhead")),u.appendChild(a),o=u}else o=a;return i.push(...$(t,o,s)),x(t,o,i),o},Ft=(t,{canvasSize:e,titleCache:s})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","polygon"),n=[];return n.push(...T(t,r)),n.push(...D(t,r)),n.push(...$(t,r,s)),n.push(...at(t,r)),n.push(...ct(t,e,r)),x(t,r,n),r},Wt=(t,{canvasSize:e,titleCache:s})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","polyline"),n=[];return n.push(...T(t,r)),n.push(...D(t,r)),n.push(...$(t,r,s)),n.push(...at(t,r)),n.push(...ct(t,e,r)),x(t,r,n),r},Lt=(t,{canvasSize:e,titleCache:s})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=[];return n.push(...$t(t,e,r)),n.push(...V(t,r)),n.push(...T(t,r)),n.push(...D(t,r)),n.push(...$(t,r,s)),n.push(...Ct(t,r)),n.push(...O(t,e,r)),x(t,r,n),r},Zt=(t,{canvasSize:e,labels:s,titleCache:r})=>{const n=document.createElementNS("http://www.w3.org/2000/svg","text"),i=[];i.push("x","y"),i.push(...T(t,n)),i.push(...D(t,n)),i.push(...$(t,n,r)),i.push(...Et(t,n)),i.push(...O(t,e,n)),i.push(...Tt(t,n));const a=t.name,o=s.get(a.contents),c=t.center,[l,u]=k([c.contents[0],c.contents[1]],e);if(o&&o.tag==="TextData"){const h=o.descent.contents,p=o.height.contents,g=u+(p/2-h);n.setAttribute("x",l.toString()),n.setAttribute("y",g.toString()),i.push(...V(t,n))}else n.setAttribute("x",l.toString()),n.setAttribute("y",u.toString());return n.setAttribute("font-size-adjust",t.fontSizeAdjust.contents),n.setAttribute("alignment-baseline",t.alignmentBaseline.contents),n.setAttribute("dominant-baseline",t.dominantBaseline.contents),n.setAttribute("ascent",t.ascent.contents.toString()),n.setAttribute("descent",t.descent.contents.toString()),n.setAttribute("text-anchor",t.textAnchor.contents.toString()),n.setAttribute("visibility",t.visibility.contents),i.push("fontSizeAdjust","alignmentBaseline","dominantBaseline","ascent","descent","textAnchor","visibility"),x(t,n,i),n},_t=async({varyingValues:t,canvas:e,computeShapes:s,labelCache:r,variation:n},i,a,o=!1,c)=>{const l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("version","1.2"),l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttribute("viewBox",`0 0 ${e.width} ${e.height}`);const u=s(t),h=u.map(C=>le(C)),p=vt(h.map(C=>he(C))),g=vt(h.map(C=>ue(C))),m=bt(h.map(C=>pe(C))),d=bt(h.map(C=>de(C))),b=[p,g,m,d],[S,w,v,f]=(await ge(b))(C=>C.val),[I,Z]=k([S,w],[e.width,e.height]),[q,_]=k([v,f],[e.width,e.height]),ut=[I,_],pt=[q-I,Z-_];l.setAttribute("penrose","0");const dt=document.createElementNS("https://penrose.cs.cmu.edu/metadata","penrose"),gt=document.createElementNS("https://penrose.cs.cmu.edu/croppedViewBox","croppedViewBox");return gt.insertAdjacentText("afterbegin",`${ut[0]} ${ut[1]} ${pt[0]} ${pt[1]}`),dt.appendChild(gt),l.appendChild(dt),await Gt(u,l,{labels:r,canvasSize:e.size,variation:n,namespace:a,texLabels:o,pathResolver:i,titleCache:c}),l},Ht=async(t,e)=>{const s=document.createElementNS("http://www.w3.org/2000/svg","g"),r=t.clipPath.contents;let n,i;if(r.tag==="Clip"){const o=r.contents;n=o.name.contents;const c=await W(o,e),l=document.createElementNS("http://www.w3.org/2000/svg","clipPath");i=e.namespace+n+"-clip",l.setAttribute("id",i),l.appendChild(c),s.appendChild(l)}const a=t.shapes.contents;for(const o of a){const c=o.name.contents;if(r.tag==="Clip"){if(c!==n){const l=await W(o,e),u=document.createElementNS("http://www.w3.org/2000/svg","g");u.appendChild(l),u.setAttribute("clip-path",`url(#${i})`),s.appendChild(u)}}else{const l=await W(o,e);s.appendChild(l)}}return x(t,s,[...$(t,s,e.titleCache),"shapes","clipPath"]),s},Xt=async(t,e)=>{switch(t.shapeType){case"Circle":return Nt(t,e);case"Ellipse":return Bt(t,e);case"Equation":return Rt(t,e);case"Image":return It(t,e);case"Line":return Vt(t,e);case"Path":return Ot(t,e);case"Polygon":return Ft(t,e);case"Polyline":return Wt(t,e);case"Rectangle":return Lt(t,e);case"Text":return Zt(t,e)}},W=async(t,e)=>{let s;return t.shapeType==="Group"?s=await Ht(t,e):s=await Xt(t,e),s},Gt=async(t,e,s)=>{for(let r=0;r<t.length;++r){const n=t[r],i=await W(n,s);e.appendChild(i)}},Ut=t=>{const e=me(t.variation);return rt({...t,varyingValues:t.inputs.map(({meta:s})=>s.init.tag==="Sampled"?s.init.sampler(e):s.init.pending),currentStageIndex:0,params:St(t.varyingValues.length)})},lt=(t,e)=>{const{constraintSets:s,optStages:r,currentStageIndex:n}=t,i=r[n],a=H(s.get(i),()=>`missing stage: ${i}`),o=new Float64Array(t.varyingValues),c=be((l,u,h)=>t.gradient(a,l,u,h).phi,o,t.params,e.until);return c.optStatus==="Error"?E({errorType:"RuntimeError",...Se("",t)}):M({...t,varyingValues:Array.from(o),params:c})},Jt=(t,e=1e4)=>{let s=0;const r=lt(t,{until:()=>s++>=e});if(r.isErr())return r;{const n=r.value;if(L(n)&&!Y(n)){const i=ht(n);return M(i)}else return r}},ht=t=>Y(t)?t:{...t,currentStageIndex:t.currentStageIndex+1,params:St(t.varyingValues.length)},Yt=t=>{let e=t;for(;!L(e)||!Y(e);){L(e)&&(e=ht(e));const s=lt(e,{until:()=>!1});if(s.isOk())e=s.value;else return s}return M(e)},Kt=async t=>{const e=fe(t.domain);if(e.isErr())return E(e.error);const s=we(t.substance,e.value);if(s.isErr())return E(s.error);const r=await ve(t.variation,t.style,t.excludeWarnings??[],s.value,e.value);if(r.isErr())return r;{const n=r.value,i=P(),a=await et(n.shapes,i);return a.isErr()?E(a.error):M(rt({...n,labelCache:a.value}))}},L=t=>t.params.optStatus==="EPConverged",Y=t=>t.currentStageIndex===t.optStages.length-1;async function Qt(t){const e=await fetch(t);if(!e.ok){console.error(`could not fetch ${t}`);return}return await e.text()}K=class extends yt.Component{constructor(e){super(e);A(this,"canvasRef",yt.createRef());A(this,"penroseState");A(this,"timerID");A(this,"compile",async()=>{this.penroseState=void 0,this.setState({error:void 0});const e=await Kt(this.props);e.isOk()?(this.penroseState=e.value,this.setState({error:void 0})):this.setState({error:e.error})});A(this,"converge",async()=>{if(this.penroseState){const e=Yt(this.penroseState);e.isOk()?this.penroseState=e.value:this.setState({error:e.error})}});A(this,"tick",()=>{if(this.props.animate&&this.penroseState&&!L(this.penroseState)){const e=Jt(this.penroseState,this.props.stepSize??1);e.isErr()?this.setState({error:e.error}):this.penroseState=e.value,this.renderCanvas()}});A(this,"componentDidMount",async()=>{await this.compile(),this.props.animate||await this.converge(),this.renderCanvas(),this.timerID=window.setInterval(()=>this.tick(),1e3/60)});A(this,"componentDidUpdate",async e=>{if(this.props.domain!==e.domain||this.props.substance!==e.substance||this.props.style!==e.style){await this.compile(),this.props.animate||await this.converge(),this.renderCanvas();return}if(this.penroseState&&!this.state.error){if(this.props.variation!==e.variation||this.props.animate!==e.animate){this.penroseState.variation=this.props.variation,this.penroseState=Ut(this.penroseState),this.props.animate||await this.converge(),this.renderCanvas();return}else if(this.props.interactive!==e.interactive){this.renderCanvas();return}}});A(this,"componentWillUnmount",()=>{clearInterval(this.timerID)});A(this,"renderCanvas",async()=>{if(this.canvasRef.current===null)return N.jsx("div",{children:"rendering..."});{const e=this.canvasRef.current;if(this.penroseState){const s=await _t(this.penroseState,this.props.imageResolver??Qt,this.props.name??"");s.setAttribute("width","100%"),s.setAttribute("height","100%"),e.firstChild!==null?e.replaceChild(s,e.firstChild):e.appendChild(s),this.props.onFrame&&this.props.onFrame(this.penroseState)}else return N.jsx("div",{children:"rendering..."})}});A(this,"render",()=>{const{error:e}=this.state;return N.jsxs(N.Fragment,{children:[!e&&N.jsx("div",{style:{width:"100%",height:"100%"},ref:this.canvasRef}),e&&N.jsxs("div",{style:{padding:"1em",height:"100%"},children:[N.jsx("div",{style:{fontWeight:700},children:"1 error:"}),N.jsx("div",{style:{fontFamily:"monospace"},children:ye(e).toString().split(`
`).map((s,r)=>N.jsx("p",{style:{margin:0},children:s},`err-ln-${r}`))})]})]})});this.state={error:void 0}}},K.__docgenInfo={description:"",methods:[{name:"compile",docblock:null,modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},{name:"converge",docblock:null,modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},{name:"tick",docblock:null,modifiers:[],params:[],returns:null},{name:"componentDidMount",docblock:null,modifiers:["async"],params:[],returns:null},{name:"componentDidUpdate",docblock:null,modifiers:["async"],params:[{name:"prevProps",optional:!1,type:{name:"SimpleProps",alias:"SimpleProps"}}],returns:null},{name:"componentWillUnmount",docblock:null,modifiers:[],params:[],returns:null},{name:"renderCanvas",docblock:null,modifiers:["async"],params:[],returns:null},{name:"render",docblock:null,modifiers:[],params:[],returns:null}],displayName:"Simple",props:{domain:{required:!0,tsType:{name:"string"},description:""},substance:{required:!0,tsType:{name:"string"},description:""},style:{required:!0,tsType:{name:"string"},description:""},variation:{required:!0,tsType:{name:"string"},description:""},excludeWarnings:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},stepSize:{required:!1,tsType:{name:"number"},description:""},interactive:{required:!1,tsType:{name:"boolean"},description:""},animate:{required:!1,tsType:{name:"boolean"},description:""},onFrame:{required:!1,tsType:{name:"signature",type:"function",raw:"(frame: PenroseState) => void",signature:{arguments:[{type:{name:"PenroseState"},name:"frame"}],return:{name:"void"}}},description:""},imageResolver:{required:!1,tsType:{name:"PathResolver"},description:""},name:{required:!1,tsType:{name:"string"},description:""}}}});export{K as S,ke as __tla};
